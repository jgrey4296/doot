## docs.toml -*- mode: toml -*-
doot-version = "0.13"

[[locations]]
doc_src = "docs"
doc_out = "{temp}/docs"
autoapi = "{doc_src}/_api"
autogen = "{doc_src}/_public_api"

[[tasks.docs]]
name    = "server"
doc     = ["run a simple server in the built docs directory"]
address = "127.0.0.1"
port    = "8000"
actions = [
    {do="log", msg="%% python -m http.server --directory {doc_out!p} --bind {address} {port} &"},
    # {do="shell", args=["python", "-m", "http.server", "--directory", "{doc_out!p}", "--bind", "{address}", "{port}"], background=true}
]

[[tasks.docs]]
name        = "build"
doc         = ["build sphinx project documentation"]
ctor        = "task"
doc_builder = "html"
env_name    = "doot-dev"
depends_on  = []
setup       = [
    { do="dootle.python.mamba:MambaEnv", env_="env_name", update_="env"},
    { do="installed?", args=["sphinx-build"], env_="env"},
    { do="exists?", args=["{doc_src!p}/conf.py"] },
]
actions = [
    # --conf-dir {!p} : directory for conf.py
    { do="shell", args=["sphinx-build",
    # "--verbose", "--verbose",
    "--write-all",
     # "--nitpicky",
     "--warning-file",
     "{logs!p}/sphinx.log",
     "--builder",
     "{doc_builder}",
     "{doc_src!p}",
     "{doc_out!p}",
     ], env_="env"}]
cleanup = []

[[tasks.docs]]
name        = "test"
doc         = ["run sphinx doctest"]
ctor        = "task"
doc_builder = "doctest"
env_name    = "distributor"
setup       = [
    { do="dootle.python.mamba:MambaEnv", env_="env_name", update_="env"},
    { do="installed?", args=["sphinx-build"], env_="env"},
    { do="exists?", args=["{doc_src!p}/conf.py"] },
]
actions = [
    # --conf-dir {!p} : directory for conf.py
    { do="shell", args=["sphinx-build", "--warning-file", "{logs!p}/sphinx.log", "--builder", "{doc_builder}", "{doc_src!p}", "{doc_out!p}"] },


]
